<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚µã‚¤ã‚¯ãƒ«ãƒ­ã‚¸ãƒƒã‚¯åˆ†æãƒ»ä¿®æ­£ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #4299e1;
        }

        .test-section h3 {
            margin-top: 0;
            color: #2d3748;
            font-size: 1.3em;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            background: #4299e1;
            color: white;
        }

        button:hover {
            background: #3182ce;
            transform: translateY(-1px);
        }

        .status-display {
            background: #edf2f7;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-line;
            border: 1px solid #cbd5e0;
            max-height: 400px;
            overflow-y: auto;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #cbd5e0;
            padding: 8px 12px;
            text-align: center;
        }

        .comparison-table th {
            background: #4299e1;
            color: white;
            font-weight: 600;
        }

        .current-logic {
            background: #fed7d7;
        }

        .correct-logic {
            background: #c6f6d5;
        }

        .problem {
            background: #fbb6ce;
            color: #c53030;
            font-weight: 600;
        }

        .correct {
            background: #68d391;
            color: #22543d;
            font-weight: 600;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .test-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid #e2e8f0;
        }

        .test-card h4 {
            margin: 0 0 10px 0;
            color: #4a5568;
            font-size: 1.1em;
        }

        .log-container {
            background: #1a202c;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-entry.success {
            color: #68d391;
        }

        .log-entry.warning {
            color: #fbb6ce;
        }

        .log-entry.info {
            color: #90cdf4;
        }

        .log-entry.error {
            color: #fc8181;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ” ã‚µã‚¤ã‚¯ãƒ«ãƒ­ã‚¸ãƒƒã‚¯åˆ†æãƒ»ä¿®æ­£ãƒ†ã‚¹ãƒˆ</h1>

        <!-- å•é¡Œã®èª¬æ˜ -->
        <div class="test-section">
            <h3>ğŸ› ç¾åœ¨ã®å®Ÿè£…ã®å•é¡Œ</h3>
            <p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ‘˜:</strong> ã‚µã‚¤ã‚¯ãƒ«æ•°4å›ã€é•·ã„ä¼‘æ†©é–“éš”2å›ã”ã¨ã®å ´åˆ</p>
            <p><strong>ç¾åœ¨ã®å‹•ä½œ:</strong></p>
            <ol>
                <li>ä½œæ¥­1 â†’ çŸ­ã„ä¼‘æ†©</li>
                <li>ä½œæ¥­2 â†’ <span class="problem">é•·ã„ä¼‘æ†©</span> (2 % 2 = 0)</li>
                <li>ä½œæ¥­3 â†’ çŸ­ã„ä¼‘æ†©</li>
                <li>ä½œæ¥­4 â†’ <span class="problem">çŸ­ã„ä¼‘æ†©</span> (4 % 2 = 0ã ãŒæœ€å¾Œãªã®ã§é™¤å¤–)</li>
            </ol>
            <p><strong>å•é¡Œ:</strong> 2å›ç›®å®Œäº†å¾Œã«é•·ã„ä¼‘æ†©ãŒæ¥ã‚‹ã®ã¯ä¸è‡ªç„¶</p>
        </div>

        <!-- æ­£ã—ã„ä»•æ§˜ã®æ¤œè¨ -->
        <div class="test-section">
            <h3>âœ… æ­£ã—ã„ä»•æ§˜ã®æ¤œè¨</h3>
            <div class="controls">
                <button onclick="analyzeCorrectLogic()">æ­£ã—ã„ãƒ­ã‚¸ãƒƒã‚¯åˆ†æ</button>
                <button onclick="compareImplementations()">å®Ÿè£…æ¯”è¼ƒ</button>
                <button onclick="testDifferentScenarios()">ç•°ãªã‚‹ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ</button>
            </div>

            <div id="correct-logic-result" class="status-display">
                æ­£ã—ã„ãƒ­ã‚¸ãƒƒã‚¯åˆ†æçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
            </div>
        </div>

        <!-- å®Ÿè£…æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ« -->
        <div class="test-section">
            <h3>ğŸ“Š å®Ÿè£…æ¯”è¼ƒ</h3>
            <div class="controls">
                <button onclick="generateComparisonTable()">æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ</button>
                <button onclick="testEdgeCases()">ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ</button>
            </div>

            <div id="comparison-table-container">
                <!-- æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ«ãŒã“ã“ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
            </div>
        </div>

        <!-- ä¿®æ­£ææ¡ˆ -->
        <div class="test-section">
            <h3>ğŸ”§ ä¿®æ­£ææ¡ˆ</h3>
            <div class="controls">
                <button onclick="proposeFix()">ä¿®æ­£æ¡ˆæç¤º</button>
                <button onclick="testProposedFix()">ä¿®æ­£æ¡ˆãƒ†ã‚¹ãƒˆ</button>
                <button onclick="validateFix()">ä¿®æ­£æ¡ˆæ¤œè¨¼</button>
            </div>

            <div id="fix-proposal-result" class="status-display">
                ä¿®æ­£ææ¡ˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
            </div>
        </div>

        <!-- ãƒ†ã‚¹ãƒˆãƒ­ã‚° -->
        <div class="test-section">
            <h3>ğŸ“‹ ãƒ†ã‚¹ãƒˆãƒ­ã‚°</h3>
            <div class="controls">
                <button onclick="clearLogs()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
                <button onclick="exportAnalysis()">åˆ†æçµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>

            <div class="log-container" id="test-log">
                ãƒ†ã‚¹ãƒˆãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...
            </div>
        </div>
    </div>

    <script>
        let testLog = [];

        // ãƒ­ã‚°é–¢æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            testLog.push(entry);

            const logContainer = document.getElementById('test-log');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = entry;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // ç¾åœ¨ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå•é¡Œã‚ã‚Šï¼‰
        function currentLogic(cycle, interval, totalCycles) {
            return cycle % interval === 0 && cycle < totalCycles;
        }

        // ææ¡ˆã™ã‚‹æ­£ã—ã„ãƒ­ã‚¸ãƒƒã‚¯
        function proposedLogic(completedCycles, interval, totalCycles) {
            // å®Œäº†ã—ãŸã‚µã‚¤ã‚¯ãƒ«æ•°ãŒé–“éš”ã®å€æ•°ã§ã€ã‹ã¤å…¨ä½“å®Œäº†å‰
            return completedCycles > 0 &&
                completedCycles % interval === 0 &&
                completedCycles < totalCycles;
        }

        // æ­£ã—ã„ãƒ­ã‚¸ãƒƒã‚¯åˆ†æ
        function analyzeCorrectLogic() {
            log('ğŸ” æ­£ã—ã„ãƒ­ã‚¸ãƒƒã‚¯åˆ†æé–‹å§‹', 'info');

            const scenarios = [
                { cycles: 4, interval: 2, description: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ‘˜ã‚±ãƒ¼ã‚¹' },
                { cycles: 4, interval: 4, description: 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚±ãƒ¼ã‚¹' },
                { cycles: 6, interval: 3, description: '6ã‚µã‚¤ã‚¯ãƒ«ãƒ»3å›ã”ã¨' },
                { cycles: 8, interval: 2, description: '8ã‚µã‚¤ã‚¯ãƒ«ãƒ»2å›ã”ã¨' }
            ];

            let result = 'æ­£ã—ã„ãƒ­ã‚¸ãƒƒã‚¯åˆ†æçµæœ:\n\n';

            scenarios.forEach(scenario => {
                result += `ã€${scenario.description}ã€‘\n`;
                result += `è¨­å®š: ${scenario.cycles}ã‚µã‚¤ã‚¯ãƒ«, ${scenario.interval}å›ã”ã¨\n\n`;

                result += 'æ­£ã—ã„å‹•ä½œ:\n';
                for (let i = 1; i <= scenario.cycles; i++) {
                    if (i < scenario.cycles) {
                        const isLongBreak = proposedLogic(i, scenario.interval, scenario.cycles);
                        const breakType = isLongBreak ? 'é•·ã„ä¼‘æ†©' : 'çŸ­ã„ä¼‘æ†©';
                        result += `  ä½œæ¥­${i}å®Œäº† â†’ ${breakType}\n`;
                    } else {
                        result += `  ä½œæ¥­${i}å®Œäº† â†’ å…¨ä½“å®Œäº†\n`;
                    }
                }
                result += '\n';

                log(`${scenario.description}: åˆ†æå®Œäº†`, 'success');
            });

            result += 'åŸå‰‡:\n';
            result += '1. é•·ã„ä¼‘æ†©ã¯ã€Œä¸€å®šæ•°ã®ä½œæ¥­å®Œäº†å¾Œã€ã«ç™ºç”Ÿ\n';
            result += '2. æœ€å¾Œã®ã‚µã‚¤ã‚¯ãƒ«å®Œäº†å¾Œã¯ä¼‘æ†©ãªã—ï¼ˆå…¨ä½“å®Œäº†ï¼‰\n';
            result += '3. é•·ã„ä¼‘æ†©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ç´¯ç©å®Œäº†æ•°ã§åˆ¤å®š';

            document.getElementById('correct-logic-result').textContent = result;
        }

        // å®Ÿè£…æ¯”è¼ƒ
        function compareImplementations() {
            log('ğŸ“Š å®Ÿè£…æ¯”è¼ƒé–‹å§‹', 'info');

            const testCase = { cycles: 4, interval: 2 };
            let result = `å®Ÿè£…æ¯”è¼ƒ (${testCase.cycles}ã‚µã‚¤ã‚¯ãƒ«, ${testCase.interval}å›ã”ã¨):\n\n`;

            result += 'ç¾åœ¨ã®å®Ÿè£… vs æ­£ã—ã„å®Ÿè£…:\n\n';

            for (let i = 1; i <= testCase.cycles; i++) {
                const currentResult = currentLogic(i, testCase.interval, testCase.cycles);
                const proposedResult = proposedLogic(i, testCase.interval, testCase.cycles);

                result += `ä½œæ¥­${i}å®Œäº†å¾Œ:\n`;
                result += `  ç¾åœ¨ã®å®Ÿè£…: ${currentResult ? 'é•·ã„ä¼‘æ†©' : 'çŸ­ã„ä¼‘æ†©'}\n`;
                result += `  æ­£ã—ã„å®Ÿè£…: ${proposedResult ? 'é•·ã„ä¼‘æ†©' : 'çŸ­ã„ä¼‘æ†©'}\n`;
                result += `  åˆ¤å®š: ${currentResult === proposedResult ? 'âœ… ä¸€è‡´' : 'âŒ ä¸ä¸€è‡´'}\n\n`;

                log(`ä½œæ¥­${i}: ${currentResult === proposedResult ? 'ä¸€è‡´' : 'ä¸ä¸€è‡´'}`,
                    currentResult === proposedResult ? 'success' : 'error');
            }

            document.getElementById('correct-logic-result').textContent = result;
        }

        // æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ
        function generateComparisonTable() {
            log('ğŸ“Š æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆé–‹å§‹', 'info');

            const scenarios = [
                { cycles: 4, interval: 2 },
                { cycles: 4, interval: 4 },
                { cycles: 6, interval: 3 },
                { cycles: 8, interval: 2 }
            ];

            let tableHTML = '<table class="comparison-table">';
            tableHTML += '<thead><tr>';
            tableHTML += '<th>ã‚·ãƒŠãƒªã‚ª</th>';
            tableHTML += '<th>ä½œæ¥­1å¾Œ</th>';
            tableHTML += '<th>ä½œæ¥­2å¾Œ</th>';
            tableHTML += '<th>ä½œæ¥­3å¾Œ</th>';
            tableHTML += '<th>ä½œæ¥­4å¾Œ</th>';
            tableHTML += '<th>ä½œæ¥­5å¾Œ</th>';
            tableHTML += '<th>ä½œæ¥­6å¾Œ</th>';
            tableHTML += '<th>ä½œæ¥­7å¾Œ</th>';
            tableHTML += '<th>ä½œæ¥­8å¾Œ</th>';
            tableHTML += '</tr></thead><tbody>';

            scenarios.forEach(scenario => {
                // ç¾åœ¨ã®å®Ÿè£…
                tableHTML += '<tr>';
                tableHTML += `<td class="current-logic">${scenario.cycles}ã‚µã‚¤ã‚¯ãƒ«<br>${scenario.interval}å›ã”ã¨<br>(ç¾åœ¨)</td>`;
                for (let i = 1; i <= 8; i++) {
                    if (i <= scenario.cycles) {
                        const isLong = currentLogic(i, scenario.interval, scenario.cycles);
                        const cellClass = i < scenario.cycles ? (isLong ? 'problem' : '') : '';
                        tableHTML += `<td class="${cellClass}">${i < scenario.cycles ? (isLong ? 'é•·ã„' : 'çŸ­ã„') : 'å®Œäº†'}</td>`;
                    } else {
                        tableHTML += '<td>-</td>';
                    }
                }
                tableHTML += '</tr>';

                // æ­£ã—ã„å®Ÿè£…
                tableHTML += '<tr>';
                tableHTML += `<td class="correct-logic">${scenario.cycles}ã‚µã‚¤ã‚¯ãƒ«<br>${scenario.interval}å›ã”ã¨<br>(ä¿®æ­£å¾Œ)</td>`;
                for (let i = 1; i <= 8; i++) {
                    if (i <= scenario.cycles) {
                        const isLong = proposedLogic(i, scenario.interval, scenario.cycles);
                        const cellClass = i < scenario.cycles ? (isLong ? 'correct' : '') : '';
                        tableHTML += `<td class="${cellClass}">${i < scenario.cycles ? (isLong ? 'é•·ã„' : 'çŸ­ã„') : 'å®Œäº†'}</td>`;
                    } else {
                        tableHTML += '<td>-</td>';
                    }
                }
                tableHTML += '</tr>';
            });

            tableHTML += '</tbody></table>';

            document.getElementById('comparison-table-container').innerHTML = tableHTML;
            log('æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆå®Œäº†', 'success');
        }

        // ç•°ãªã‚‹ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ
        function testDifferentScenarios() {
            log('ğŸ§ª ç•°ãªã‚‹ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            const scenarios = [
                { cycles: 2, interval: 2, expected: 'çŸ­ã„ä¼‘æ†©ã®ã¿' },
                { cycles: 3, interval: 2, expected: 'ä½œæ¥­2å¾Œã«é•·ã„ä¼‘æ†©' },
                { cycles: 4, interval: 2, expected: 'ä½œæ¥­2å¾Œã«é•·ã„ä¼‘æ†©' },
                { cycles: 6, interval: 2, expected: 'ä½œæ¥­2,4å¾Œã«é•·ã„ä¼‘æ†©' },
                { cycles: 6, interval: 3, expected: 'ä½œæ¥­3å¾Œã«é•·ã„ä¼‘æ†©' },
                { cycles: 9, interval: 3, expected: 'ä½œæ¥­3,6å¾Œã«é•·ã„ä¼‘æ†©' }
            ];

            let result = 'ç•°ãªã‚‹ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆçµæœ:\n\n';

            scenarios.forEach((scenario, index) => {
                result += `${index + 1}. ${scenario.cycles}ã‚µã‚¤ã‚¯ãƒ«ãƒ»${scenario.interval}å›ã”ã¨\n`;
                result += `   æœŸå¾…: ${scenario.expected}\n`;
                result += '   å®Ÿéš›: ';

                const longBreaks = [];
                for (let i = 1; i < scenario.cycles; i++) {
                    if (proposedLogic(i, scenario.interval, scenario.cycles)) {
                        longBreaks.push(`ä½œæ¥­${i}å¾Œ`);
                    }
                }

                if (longBreaks.length === 0) {
                    result += 'çŸ­ã„ä¼‘æ†©ã®ã¿';
                } else {
                    result += `${longBreaks.join(', ')}ã«é•·ã„ä¼‘æ†©`;
                }
                result += '\n\n';

                log(`ã‚·ãƒŠãƒªã‚ª${index + 1}: ${scenario.cycles}ã‚µã‚¤ã‚¯ãƒ«ãƒ»${scenario.interval}å›ã”ã¨`, 'info');
            });

            document.getElementById('correct-logic-result').textContent = result;
        }

        // ä¿®æ­£ææ¡ˆ
        function proposeFix() {
            log('ğŸ”§ ä¿®æ­£ææ¡ˆé–‹å§‹', 'info');

            const result = `
ä¿®æ­£ææ¡ˆ:

ã€ç¾åœ¨ã®å•é¡Œã®ã‚ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã€‘
const isLongBreak = cycleSettings.currentCycle % cycleSettings.longBreakInterval === 0 &&
                   cycleSettings.currentCycle < cycleSettings.totalCycles;

ã€ä¿®æ­£å¾Œã®æ­£ã—ã„ãƒ­ã‚¸ãƒƒã‚¯ã€‘
// æ–¹æ³•1: å®Œäº†ã—ãŸã‚µã‚¤ã‚¯ãƒ«æ•°ã§åˆ¤å®š
const completedCycles = cycleSettings.currentCycle;
const isLongBreak = completedCycles > 0 &&
                   completedCycles % cycleSettings.longBreakInterval === 0 &&
                   completedCycles < cycleSettings.totalCycles;

// æ–¹æ³•2: ã‚ˆã‚Šæ˜ç¢ºãªæ¡ä»¶åˆ†å²
function shouldTakeLongBreak(completedCycles, interval, totalCycles) {
  // æœ€å¾Œã®ã‚µã‚¤ã‚¯ãƒ«ã§ã¯ä¼‘æ†©ãªã—
  if (completedCycles >= totalCycles) return false;

  // é–“éš”ã®å€æ•°ã®æ™‚ã«é•·ã„ä¼‘æ†©
  return completedCycles > 0 && completedCycles % interval === 0;
}

ã€ä¿®æ­£ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã€‘
1. src/popup/popup.ts - è¡¨ç¤ºåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
2. src/background.ts - ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯
3. src/utils/cycle.ts - shouldTakeLongBreaké–¢æ•°

ã€ä¿®æ­£ã®åŠ¹æœã€‘
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ‘˜ã®å•é¡ŒãŒè§£æ±º
- ã‚ˆã‚Šç›´æ„Ÿçš„ãªé•·ã„ä¼‘æ†©ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- ä¸€èˆ¬çš„ãªãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã«æº–æ‹ 
            `;

            document.getElementById('fix-proposal-result').textContent = result;
            log('ä¿®æ­£ææ¡ˆå®Œäº†', 'success');
        }

        // ä¿®æ­£æ¡ˆãƒ†ã‚¹ãƒˆ
        function testProposedFix() {
            log('ğŸ§ª ä¿®æ­£æ¡ˆãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            const testCases = [
                { cycles: 4, interval: 2, description: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ‘˜ã‚±ãƒ¼ã‚¹' },
                { cycles: 4, interval: 4, description: 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚±ãƒ¼ã‚¹' },
                { cycles: 6, interval: 3, description: '6ã‚µã‚¤ã‚¯ãƒ«ãƒ»3å›ã”ã¨' }
            ];

            let result = 'ä¿®æ­£æ¡ˆãƒ†ã‚¹ãƒˆçµæœ:\n\n';

            testCases.forEach(testCase => {
                result += `ã€${testCase.description}ã€‘\n`;
                result += `è¨­å®š: ${testCase.cycles}ã‚µã‚¤ã‚¯ãƒ«, ${testCase.interval}å›ã”ã¨\n`;

                for (let i = 1; i <= testCase.cycles; i++) {
                    if (i < testCase.cycles) {
                        const isLongBreak = proposedLogic(i, testCase.interval, testCase.cycles);
                        result += `  ä½œæ¥­${i}å®Œäº† â†’ ${isLongBreak ? 'é•·ã„ä¼‘æ†©' : 'çŸ­ã„ä¼‘æ†©'}\n`;
                    } else {
                        result += `  ä½œæ¥­${i}å®Œäº† â†’ å…¨ä½“å®Œäº†\n`;
                    }
                }
                result += '\n';

                log(`${testCase.description}: ãƒ†ã‚¹ãƒˆå®Œäº†`, 'success');
            });

            document.getElementById('fix-proposal-result').textContent = result;
        }

        // ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
        function testEdgeCases() {
            log('ğŸ” ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            const edgeCases = [
                { cycles: 1, interval: 2, description: '1ã‚µã‚¤ã‚¯ãƒ«ã®ã¿' },
                { cycles: 2, interval: 2, description: 'é–“éš”ã¨åŒã˜ã‚µã‚¤ã‚¯ãƒ«æ•°' },
                { cycles: 2, interval: 3, description: 'é–“éš”ã‚ˆã‚Šå°‘ãªã„ã‚µã‚¤ã‚¯ãƒ«æ•°' },
                { cycles: 10, interval: 1, description: 'æ¯å›é•·ã„ä¼‘æ†©' }
            ];

            let tableHTML = '<h4>ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆçµæœ</h4>';
            tableHTML += '<table class="comparison-table">';
            tableHTML += '<thead><tr><th>ã‚±ãƒ¼ã‚¹</th><th>è¨­å®š</th><th>çµæœ</th><th>åˆ¤å®š</th></tr></thead><tbody>';

            edgeCases.forEach(edgeCase => {
                let result = '';
                let isValid = true;

                for (let i = 1; i <= edgeCase.cycles; i++) {
                    if (i < edgeCase.cycles) {
                        const isLongBreak = proposedLogic(i, edgeCase.interval, edgeCase.cycles);
                        result += `ä½œæ¥­${i}â†’${isLongBreak ? 'é•·' : 'çŸ­'} `;
                    } else {
                        result += `ä½œæ¥­${i}â†’å®Œäº†`;
                    }
                }

                tableHTML += '<tr>';
                tableHTML += `<td>${edgeCase.description}</td>`;
                tableHTML += `<td>${edgeCase.cycles}ã‚µã‚¤ã‚¯ãƒ«<br>${edgeCase.interval}å›ã”ã¨</td>`;
                tableHTML += `<td>${result}</td>`;
                tableHTML += `<td class="${isValid ? 'correct' : 'problem'}">${isValid ? 'âœ… æ­£å¸¸' : 'âŒ ç•°å¸¸'}</td>`;
                tableHTML += '</tr>';

                log(`ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: ${edgeCase.description}`, isValid ? 'success' : 'error');
            });

            tableHTML += '</tbody></table>';
            document.getElementById('comparison-table-container').innerHTML = tableHTML;
        }

        // ä¿®æ­£æ¡ˆæ¤œè¨¼
        function validateFix() {
            log('âœ… ä¿®æ­£æ¡ˆæ¤œè¨¼é–‹å§‹', 'info');

            const validationTests = [
                {
                    name: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ‘˜å•é¡Œã®è§£æ±º',
                    test: () => {
                        // 4ã‚µã‚¤ã‚¯ãƒ«ã€2å›ã”ã¨
                        const results = [];
                        for (let i = 1; i < 4; i++) {
                            results.push(proposedLogic(i, 2, 4));
                        }
                        // æœŸå¾…: [false, true, false] (ä½œæ¥­2å¾Œã®ã¿é•·ã„ä¼‘æ†©)
                        return results[0] === false && results[1] === true && results[2] === false;
                    }
                },
                {
                    name: 'æœ€å¾Œã®ã‚µã‚¤ã‚¯ãƒ«å¾Œã¯ä¼‘æ†©ãªã—',
                    test: () => {
                        // ä»»æ„ã®è¨­å®šã§æœ€å¾Œã®ã‚µã‚¤ã‚¯ãƒ«ã¯ä¼‘æ†©ãªã—
                        return !proposedLogic(4, 2, 4) && !proposedLogic(6, 3, 6);
                    }
                },
                {
                    name: 'é–“éš”ã®å€æ•°ã§é•·ã„ä¼‘æ†©',
                    test: () => {
                        // 6ã‚µã‚¤ã‚¯ãƒ«ã€3å›ã”ã¨ â†’ ä½œæ¥­3å¾Œã«é•·ã„ä¼‘æ†©
                        return proposedLogic(3, 3, 6) && !proposedLogic(1, 3, 6) && !proposedLogic(2, 3, 6);
                    }
                }
            ];

            let result = 'ä¿®æ­£æ¡ˆæ¤œè¨¼çµæœ:\n\n';
            let allPassed = true;

            validationTests.forEach((test, index) => {
                const passed = test.test();
                allPassed = allPassed && passed;

                result += `${index + 1}. ${test.name}: ${passed ? 'âœ… åˆæ ¼' : 'âŒ ä¸åˆæ ¼'}\n`;
                log(`æ¤œè¨¼${index + 1}: ${test.name} - ${passed ? 'åˆæ ¼' : 'ä¸åˆæ ¼'}`, passed ? 'success' : 'error');
            });

            result += `\nç·åˆåˆ¤å®š: ${allPassed ? 'âœ… å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼' : 'âŒ ä¸€éƒ¨ãƒ†ã‚¹ãƒˆä¸åˆæ ¼'}`;
            result += '\n\nä¿®æ­£æ¡ˆã¯æ­£ã—ãå‹•ä½œã—ã¾ã™ã€‚å®Ÿè£…ã«é€²ã‚€ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚';

            document.getElementById('fix-proposal-result').textContent = result;
            log(`ç·åˆåˆ¤å®š: ${allPassed ? 'å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼' : 'ä¸€éƒ¨ãƒ†ã‚¹ãƒˆä¸åˆæ ¼'}`, allPassed ? 'success' : 'error');
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function clearLogs() {
            testLog = [];
            document.getElementById('test-log').innerHTML = '';
            log('ğŸ“‹ ãƒ­ã‚°ã‚¯ãƒªã‚¢å®Œäº†', 'info');
        }

        function exportAnalysis() {
            const analysis = {
                timestamp: new Date().toISOString(),
                problem: 'ã‚µã‚¤ã‚¯ãƒ«ãƒ­ã‚¸ãƒƒã‚¯ã®å•é¡Œ',
                currentLogic: 'cycle % interval === 0 && cycle < totalCycles',
                proposedLogic: 'completedCycles > 0 && completedCycles % interval === 0 && completedCycles < totalCycles',
                testLog: testLog,
                recommendation: 'ä¿®æ­£æ¡ˆã®å®Ÿè£…ã‚’æ¨å¥¨'
            };

            const blob = new Blob([JSON.stringify(analysis, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cycle-logic-analysis-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);

            log('ğŸ“ åˆ†æçµæœã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸ” ã‚µã‚¤ã‚¯ãƒ«ãƒ­ã‚¸ãƒƒã‚¯åˆ†æãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†', 'success');
            log('ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ‘˜ã®å•é¡Œã‚’åˆ†æã—ã¾ã™', 'info');
        });
    </script>
</body>

</html>
