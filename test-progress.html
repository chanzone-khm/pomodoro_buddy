<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .test-section h3 {
            margin-top: 0;
            color: #555;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #0056b3;
        }
        input[type="range"] {
            width: 200px;
        }
        select {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .progress-demo {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 150px;
            margin: 20px 0;
        }
        .info {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h3>ğŸ“Š ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼è¨­å®š</h3>
            <div class="controls">
                <label>
                    é€²è¡Œç‡: 
                    <input type="range" id="progress-slider" min="0" max="100" value="0">
                    <span id="progress-value">0%</span>
                </label>
                
                <label>
                    å½¢å¼: 
                    <select id="progress-type">
                        <option value="circular">å††å½¢</option>
                        <option value="linear">ãƒªãƒ‹ã‚¢</option>
                    </select>
                </label>
                
                <label>
                    <input type="checkbox" id="show-percentage" checked>
                    ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸è¡¨ç¤º
                </label>
                
                <label>
                    ã‚»ãƒƒã‚·ãƒ§ãƒ³: 
                    <select id="session-type">
                        <option value="work">ä½œæ¥­ä¸­</option>
                        <option value="break">ä¼‘æ†©ä¸­</option>
                    </select>
                </label>
            </div>
            
            <div class="controls">
                <button onclick="startDemo()">ãƒ‡ãƒ¢é–‹å§‹</button>
                <button onclick="stopDemo()">ãƒ‡ãƒ¢åœæ­¢</button>
                <button onclick="resetProgress()">ãƒªã‚»ãƒƒãƒˆ</button>
                <button onclick="testAnimation()">ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ</button>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ å††å½¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼</h3>
            <div class="progress-demo">
                <div id="circular-progress-container"></div>
            </div>
            <div class="info">
                å††å½¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆã€‚SVGã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿç¾ã€‚
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ ãƒªãƒ‹ã‚¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼</h3>
            <div class="progress-demo">
                <div id="linear-progress-container"></div>
            </div>
            <div class="info">
                ãƒªãƒ‹ã‚¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆã€‚CSSãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã§ã‚¹ãƒ ãƒ¼ã‚ºãªé€²è¡Œã‚’è¡¨ç¤ºã€‚
            </div>
        </div>

        <div class="test-section">
            <h3>âš™ï¸ è¨­å®šãƒ†ã‚¹ãƒˆ</h3>
            <div class="controls">
                <button onclick="testWorkColors()">ä½œæ¥­è‰²ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testBreakColors()">ä¼‘æ†©è‰²ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testSizeVariations()">ã‚µã‚¤ã‚ºãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³</button>
                <button onclick="saveTestSettings()">è¨­å®šä¿å­˜ãƒ†ã‚¹ãƒˆ</button>
            </div>
            <div id="settings-result" class="info" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h3>
            <div class="controls">
                <button onclick="performanceTest()">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <button onclick="memoryTest()">ãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆ</button>
            </div>
            <div id="performance-result" class="info" style="display: none;"></div>
        </div>
    </div>

    <script type="module">
        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        import { 
            calculateProgressState,
            createCircularProgressBar,
            createLinearProgressBar,
            updateProgressBarElement,
            DEFAULT_PROGRESS_SETTINGS,
            saveProgressSettings,
            loadProgressSettings
        } from './src/utils/progress.js';

        // ãƒ†ã‚¹ãƒˆç”¨ã®çŠ¶æ…‹
        let currentProgress = 0;
        let demoInterval = null;
        let progressSettings = { ...DEFAULT_PROGRESS_SETTINGS };

        // DOMè¦ç´ 
        const progressSlider = document.getElementById('progress-slider');
        const progressValue = document.getElementById('progress-value');
        const progressTypeSelect = document.getElementById('progress-type');
        const showPercentageCheckbox = document.getElementById('show-percentage');
        const sessionTypeSelect = document.getElementById('session-type');
        const circularContainer = document.getElementById('circular-progress-container');
        const linearContainer = document.getElementById('linear-progress-container');

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        progressSlider.addEventListener('input', updateProgress);
        progressTypeSelect.addEventListener('change', updateSettings);
        showPercentageCheckbox.addEventListener('change', updateSettings);
        sessionTypeSelect.addEventListener('change', updateSettings);

        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
        function updateProgress() {
            currentProgress = parseInt(progressSlider.value);
            progressValue.textContent = `${currentProgress}%`;
            renderProgressBars();
        }

        // è¨­å®šæ›´æ–°
        function updateSettings() {
            progressSettings.type = progressTypeSelect.value;
            progressSettings.showPercentage = showPercentageCheckbox.checked;
            renderProgressBars();
        }

        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderProgressBars() {
            const sessionType = sessionTypeSelect.value === 'work' ? 'Work' : 'Break';
            
            // ãƒ¢ãƒƒã‚¯ã®ã‚¿ã‚¤ãƒãƒ¼çŠ¶æ…‹ã‚’ä½œæˆ
            const mockTimerState = {
                type: sessionType,
                durationSec: 1500, // 25åˆ†
                isRunning: true,
                startEpoch: Date.now(),
                pausedAt: undefined,
                pausedElapsed: undefined
            };

            const remainingTime = Math.floor((100 - currentProgress) / 100 * 1500);
            const progressState = calculateProgressState(mockTimerState, remainingTime);

            // å††å½¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
            const circularHTML = createCircularProgressBar(progressState, progressSettings, 120);
            circularContainer.innerHTML = circularHTML;

            // ãƒªãƒ‹ã‚¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
            const linearHTML = createLinearProgressBar(progressState, progressSettings, 300);
            linearContainer.innerHTML = linearHTML;
        }

        // ãƒ‡ãƒ¢é–‹å§‹
        window.startDemo = function() {
            if (demoInterval) clearInterval(demoInterval);
            
            currentProgress = 0;
            demoInterval = setInterval(() => {
                currentProgress += 1;
                if (currentProgress > 100) {
                    currentProgress = 0;
                }
                progressSlider.value = currentProgress;
                updateProgress();
            }, 100);
        };

        // ãƒ‡ãƒ¢åœæ­¢
        window.stopDemo = function() {
            if (demoInterval) {
                clearInterval(demoInterval);
                demoInterval = null;
            }
        };

        // ãƒªã‚»ãƒƒãƒˆ
        window.resetProgress = function() {
            stopDemo();
            currentProgress = 0;
            progressSlider.value = 0;
            updateProgress();
        };

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
        window.testAnimation = function() {
            const steps = [0, 25, 50, 75, 100, 75, 50, 25, 0];
            let stepIndex = 0;
            
            const animateStep = () => {
                if (stepIndex < steps.length) {
                    currentProgress = steps[stepIndex];
                    progressSlider.value = currentProgress;
                    updateProgress();
                    stepIndex++;
                    setTimeout(animateStep, 500);
                }
            };
            
            animateStep();
        };

        // ä½œæ¥­è‰²ãƒ†ã‚¹ãƒˆ
        window.testWorkColors = function() {
            sessionTypeSelect.value = 'work';
            updateSettings();
            testAnimation();
        };

        // ä¼‘æ†©è‰²ãƒ†ã‚¹ãƒˆ
        window.testBreakColors = function() {
            sessionTypeSelect.value = 'break';
            updateSettings();
            testAnimation();
        };

        // ã‚µã‚¤ã‚ºãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
        window.testSizeVariations = function() {
            const sizes = [80, 100, 120, 140];
            let sizeIndex = 0;
            
            const testSize = () => {
                if (sizeIndex < sizes.length) {
                    const size = sizes[sizeIndex];
                    console.log(`ã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ: ${size}px`);
                    
                    // å††å½¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚µã‚¤ã‚ºã‚’å¤‰æ›´
                    const sessionType = sessionTypeSelect.value === 'work' ? 'Work' : 'Break';
                    const mockTimerState = {
                        type: sessionType,
                        durationSec: 1500,
                        isRunning: true,
                        startEpoch: Date.now()
                    };
                    const remainingTime = Math.floor((100 - currentProgress) / 100 * 1500);
                    const progressState = calculateProgressState(mockTimerState, remainingTime);
                    
                    const circularHTML = createCircularProgressBar(progressState, progressSettings, size);
                    circularContainer.innerHTML = circularHTML;
                    
                    sizeIndex++;
                    setTimeout(testSize, 1000);
                }
            };
            
            testSize();
        };

        // è¨­å®šä¿å­˜ãƒ†ã‚¹ãƒˆ
        window.saveTestSettings = async function() {
            const settingsResult = document.getElementById('settings-result');
            
            try {
                await saveProgressSettings(progressSettings);
                const loadedSettings = await loadProgressSettings();
                
                settingsResult.style.display = 'block';
                settingsResult.innerHTML = `
                    <strong>è¨­å®šä¿å­˜ãƒ†ã‚¹ãƒˆçµæœ:</strong><br>
                    ä¿å­˜ã•ã‚ŒãŸè¨­å®š: ${JSON.stringify(progressSettings, null, 2)}<br>
                    èª­ã¿è¾¼ã¾ã‚ŒãŸè¨­å®š: ${JSON.stringify(loadedSettings, null, 2)}<br>
                    <span style="color: green;">âœ… è¨­å®šã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™</span>
                `;
            } catch (error) {
                settingsResult.style.display = 'block';
                settingsResult.innerHTML = `
                    <strong>è¨­å®šä¿å­˜ãƒ†ã‚¹ãƒˆçµæœ:</strong><br>
                    <span style="color: red;">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</span>
                `;
            }
        };

        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        window.performanceTest = function() {
            const performanceResult = document.getElementById('performance-result');
            const iterations = 1000;
            
            console.time('ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ç”Ÿæˆãƒ†ã‚¹ãƒˆ');
            
            for (let i = 0; i < iterations; i++) {
                const mockTimerState = {
                    type: 'Work',
                    durationSec: 1500,
                    isRunning: true,
                    startEpoch: Date.now()
                };
                const remainingTime = Math.floor(Math.random() * 1500);
                const progressState = calculateProgressState(mockTimerState, remainingTime);
                
                createCircularProgressBar(progressState, progressSettings, 120);
                createLinearProgressBar(progressState, progressSettings, 300);
            }
            
            console.timeEnd('ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ç”Ÿæˆãƒ†ã‚¹ãƒˆ');
            
            performanceResult.style.display = 'block';
            performanceResult.innerHTML = `
                <strong>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆçµæœ:</strong><br>
                ${iterations}å›ã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ç”Ÿæˆã‚’å®Ÿè¡Œã—ã¾ã—ãŸã€‚<br>
                è©³ç´°ãªçµæœã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚<br>
                <span style="color: green;">âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†</span>
            `;
        };

        // ãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆ
        window.memoryTest = function() {
            const performanceResult = document.getElementById('performance-result');
            
            if (performance.memory) {
                const memoryInfo = {
                    used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
                    total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),
                    limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024)
                };
                
                performanceResult.style.display = 'block';
                performanceResult.innerHTML = `
                    <strong>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡:</strong><br>
                    ä½¿ç”¨ä¸­: ${memoryInfo.used} MB<br>
                    åˆè¨ˆ: ${memoryInfo.total} MB<br>
                    åˆ¶é™: ${memoryInfo.limit} MB<br>
                    <span style="color: blue;">â„¹ï¸ ãƒ¡ãƒ¢ãƒªæƒ…å ±ã‚’å–å¾—ã—ã¾ã—ãŸ</span>
                `;
            } else {
                performanceResult.style.display = 'block';
                performanceResult.innerHTML = `
                    <span style="color: orange;">âš ï¸ ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ãƒ¡ãƒ¢ãƒªæƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“</span>
                `;
            }
        };

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            updateProgress();
        });
    </script>
</body>
</html> 