# 🧪 ポモドーロバディ テスト手順書

## 🚀 クイックテスト（5分間）

### 前提条件
1. Chrome拡張機能がインストール済み
2. デベロッパーツールを開ける状態

### Step 1: 基本動作確認（2分）
1. **ポップアップ表示**
   - [ ] 拡張機能アイコンをクリック
   - [ ] ポップアップが正常表示される
   - [ ] タイマー表示が「25:00」になっている

2. **デバッグモード有効化**
   - [ ] 設定を開く
   - [ ] 「デバッグモード」をONにする
   - [ ] 作業時間が「10秒」に変更される

### Step 2: タスク管理確認（2分）
1. **タスク作成**
   - [ ] 「+ 追加」ボタンクリック
   - [ ] タスク名: "テストタスク1"
   - [ ] 予想ポモドーロ数: 2
   - [ ] 保存

2. **カンバンボード**
   - [ ] 「📋 カンバン」ボタンクリック
   - [ ] 新しいタブでタスクマネージャーが開く
   - [ ] タスクがBacklog列に表示される

### Step 3: スロット機能確認（1分）
1. **スロット割り当て**
   - [ ] タスクを空のスロットにドラッグ&ドロップ
   - [ ] 2つの連続スロットが確保される
   - [ ] タスクステータスが「Doing」に変更される

### Step 4: 新機能確認（2分）
1. **プラン追加ボタン**
   - [ ] Backlogタスクに「+」ボタンが表示される
   - [ ] 「+」ボタンクリックでプランに自動追加される
   - [ ] 複数ポモドーロタスクで複数スロットが確保される
   - [ ] プラン済みタスクに「📅 プラン済み」表示される

2. **プラン削除機能**
   - [ ] スロットの「✕」ボタンでプランから削除できる
   - [ ] 削除確認ダイアログが表示される

3. **スロット選択改善**
   - [ ] 空スロットクリックでタスク選択モーダル
   - [ ] 番号入力が正確に動作する
   - [ ] 無効入力時に適切なエラーメッセージ

## 📋 詳細テストシナリオ

### テストケース1: エンドツーエンド基本フロー

#### 目的
タスク作成からポモドーロ完了まで一連の流れを確認

#### 手順
1. **準備**
   ```
   - ブラウザを開く
   - 拡張機能を有効化
   - デベロッパーツール → Console開く
   ```

2. **タスク作成**
   ```
   1. ポップアップを開く
   2. 「+ 追加」ボタンクリック
   3. タスク情報入力:
      - 名前: "重要なレポート作成"
      - 説明: "四半期レポートのドラフト作成"
      - 予想ポモドーロ数: 3
   4. 保存をクリック
   ```

3. **スロット計画**
   ```
   1. 「📋 カンバン」ボタンクリック
   2. タスクマネージャーが開くことを確認
   3. 今日のスロット表示を確認（0/6使用）
   4. タスクをスロット1にドラッグ&ドロップ
   5. スロット1〜3が予約されることを確認
   6. 使用スロット表示が3/6に更新される
   ```

4. **ポモドーロ実行**
   ```
   1. ポップアップに戻る
   2. デバッグモードを有効化（10秒テスト用）
   3. 「開始」ボタンクリック
   4. 10秒待機
   5. 通知とアラームを確認
   6. タスクの実績が0→1に更新される
   ```

5. **進捗確認**
   ```
   1. タスクマネージャーを確認
   2. タスクの進捗表示: 🍅 1/3
   3. スロット1が完了マークに変更される
   4. 残りスロット2〜3が継続表示される
   ```

#### 期待結果
- [ ] タスクが正常に作成される
- [ ] スロット予約が正しく動作する
- [ ] ポモドーロ完了で実績が更新される
- [ ] UIが同期して更新される

---

### テストケース2: 複数タスクの並行管理

#### 目的
複数タスクを同時に管理できることを確認

#### 手順
1. **複数タスク作成**
   ```
   タスクA: "メール返信" (1ポモドーロ)
   タスクB: "資料作成" (2ポモドーロ)
   タスクC: "ミーティング準備" (1ポモドーロ)
   ```

2. **スロット配置**
   ```
   スロット1: タスクA
   スロット2-3: タスクB
   スロット4: タスクC
   スロット5-6: 空き
   ```

3. **実行とフロー確認**
   ```
   1. タスクAを完了 → Done列に移動確認
   2. タスクBを1ポモドーロ実行 → 進捗1/2確認
   3. タスクCを完了 → Done列に移動確認
   4. タスクBを2ポモドーロ目完了 → Done列に移動確認
   ```

#### 期待結果
- [ ] 各タスクが独立してカウントされる
- [ ] ステータス変更が正しく反映される
- [ ] スロット表示が正確に更新される

---

### テストケース3: データ永続化

#### 目的
ブラウザ再起動後もデータが保持されることを確認

#### 手順
1. **データ作成**
   ```
   - タスク3つ作成（各種ステータス）
   - スロット配置設定
   - 統計データ蓄積
   ```

2. **ブラウザ再起動**
   ```
   1. Chrome完全終了
   2. Chrome再起動
   3. 拡張機能アクセス
   ```

3. **データ確認**
   ```
   1. タスクリスト確認
   2. スロット配置確認
   3. 進捗データ確認
   4. 統計データ確認
   ```

#### 期待結果
- [ ] すべてのタスクが保持される
- [ ] スロット配置が保持される
- [ ] 統計データが保持される

---

### テストケース4: エラー処理

#### 目的
異常な操作に対する適切なエラー処理を確認

#### 手順
1. **無効データ入力**
   ```
   - 空のタスク名で保存
   - 負の数値のポモドーロ数入力
   - 異常に長いタスク名入力
   ```

2. **同期エラー**
   ```
   - 複数タブ同時操作
   - ストレージエラーシミュレート
   ```

3. **UI状態異常**
   ```
   - 割り当て済みスロットに重複割り当て
   - 存在しないタスクの操作
   ```

#### 期待結果
- [ ] 適切なエラーメッセージ表示
- [ ] データ整合性の保持
- [ ] 操作可能な状態での復旧

---

## 🔧 デバッグツール

### Chrome DevTools活用
```javascript
// ストレージ内容確認
chrome.storage.sync.get(null, console.log);

// タスクデータ確認
chrome.storage.sync.get('tasks', console.log);

// スロット状態確認
chrome.storage.sync.get('dayPlans', console.log);
```

### ログ確認ポイント
- Background Script Console
- Popup DevTools Console
- Task Manager DevTools Console

### パフォーマンス指標
- ポップアップ開画時間: < 500ms
- タスクマネージャー起動時間: < 1000ms
- ドラッグ&ドロップ応答時間: < 100ms

## 🚨 既知の制限事項
1. スロット数上限: 12個
2. タスク名最大長: 100文字
3. 説明最大長: 500文字
4. 同時編集: 非対応（最後の操作が優先）

## 🔧 修正済みバグ
### 2024年修正: カンバンタスク追加時の無限ループ
- **問題**: タスク追加時にKanbanBoard ↔ TaskManagerの無限ループ発生
- **原因**: `refresh()` → `onTaskUpdate()` → `handleComponentUpdate()` → `refresh()`の循環呼び出し
- **修正**: `refreshSilent()`メソッド追加でコールバック呼び出しを制御
- **確認方法**: タスク追加時にUIが安定してることを確認

### 2024年修正 v1.2: プラン管理機能の改善
- **問題1**: プラン追加がドラッグ&ドロップのみで直感的でない
- **修正**: カンバンにプラン追加ボタン（+）を実装、ワンクリックで追加可能
- **問題2**: プランからの削除ボタン（✕）が動作しない
- **修正**: イベント伝搬制御とエラーハンドリングを改善
- **問題3**: スロット選択モーダルで番号入力が不安定
- **修正**: 入力検証とリトライ機能を追加、より確実な操作を実現

### 2024年修正 v1.3: ストレージ制限エラーの解決
- **問題**: 「MAX_WRITE_OPERATIONS_PER_HOUR quota exceeded」エラー発生
- **原因**: chrome.storage.sync APIの1時間1,800回制限を超過
- **修正内容**:
  - デバウンス処理（1秒間隔）で書き込み頻度を削減
  - 状態変更時のみ保存する条件分岐を追加
  - chrome.storage.localをフォールバックとして活用
  - エラーハンドリングとログ改善
- **効果**: 90%以上の書き込み削減、安定動作を実現

## 📊 テスト報告テンプレート

```markdown
## テスト実行報告

**日時**: YYYY/MM/DD HH:MM
**テスター**: [名前]
**ブラウザ**: Chrome vXX.X.X
**OS**: Windows/Mac/Linux

### 実行結果
- [ ] テストケース1: ✅ Pass / ❌ Fail
- [ ] テストケース2: ✅ Pass / ❌ Fail
- [ ] テストケース3: ✅ Pass / ❌ Fail
- [ ] テストケース4: ✅ Pass / ❌ Fail

### 発見された問題
1. [問題の説明]
   - 再現手順: [手順]
   - 期待結果: [期待]
   - 実際結果: [実際]

### 追加コメント
[その他の気づき・提案]
```
