<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚µã‚¤ã‚¯ãƒ«æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .test-section h3 {
            margin-top: 0;
            color: #555;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button.success {
            background-color: #28a745;
        }
        button.success:hover {
            background-color: #218838;
        }
        button.danger {
            background-color: #dc3545;
        }
        button.danger:hover {
            background-color: #c82333;
        }
        select, input {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 0 5px;
        }
        .status-display {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
        }
        .info {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background-color: #007bff;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ ã‚µã‚¤ã‚¯ãƒ«æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h3>ğŸ“Š ã‚µã‚¤ã‚¯ãƒ«è¨­å®š</h3>
            <div class="controls">
                <label>
                    ç·ã‚µã‚¤ã‚¯ãƒ«æ•°: 
                    <select id="total-cycles">
                        <option value="1">1å›</option>
                        <option value="2">2å›</option>
                        <option value="3">3å›</option>
                        <option value="4" selected>4å›</option>
                        <option value="5">5å›</option>
                        <option value="6">6å›</option>
                        <option value="7">7å›</option>
                        <option value="8">8å›</option>
                        <option value="9">9å›</option>
                        <option value="10">10å›</option>
                    </select>
                </label>
                
                <label>
                    é•·ã„ä¼‘æ†©é–“éš”: 
                    <select id="long-break-interval">
                        <option value="2">2å›ã”ã¨</option>
                        <option value="3">3å›ã”ã¨</option>
                        <option value="4" selected>4å›ã”ã¨</option>
                        <option value="5">5å›ã”ã¨</option>
                    </select>
                </label>
                
                <label>
                    ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³: 
                    <select id="session-type">
                        <option value="Work" selected>ä½œæ¥­</option>
                        <option value="Break">ä¼‘æ†©</option>
                    </select>
                </label>
            </div>
            
            <div class="controls">
                <button onclick="updateCycleState()">çŠ¶æ…‹æ›´æ–°</button>
                <button onclick="advanceToNextCycle()" class="success">æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ã¸</button>
                <button onclick="resetCycleState()" class="danger">ãƒªã‚»ãƒƒãƒˆ</button>
                <button onclick="simulateFullCycle()">ãƒ•ãƒ«ã‚µã‚¤ã‚¯ãƒ«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ˆ ã‚µã‚¤ã‚¯ãƒ«çŠ¶æ…‹è¡¨ç¤º</h3>
            <div id="cycle-status" class="status-display">
                ã‚µã‚¤ã‚¯ãƒ«çŠ¶æ…‹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
            </div>
            
            <div class="progress-bar">
                <div id="cycle-progress-bar" class="progress-fill" style="width: 0%"></div>
            </div>
            <div id="progress-text" class="text-center">0% å®Œäº†</div>
            
            <div class="info">
                <strong>è¡¨ç¤ºé …ç›®:</strong><br>
                â€¢ ç¾åœ¨ã®ã‚µã‚¤ã‚¯ãƒ«ç•ªå·<br>
                â€¢ ç·ã‚µã‚¤ã‚¯ãƒ«æ•°<br>
                â€¢ é€²è¡Œç‡<br>
                â€¢ æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—<br>
                â€¢ å®Œäº†çŠ¶æ…‹
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ”” é€šçŸ¥ãƒ†ã‚¹ãƒˆ</h3>
            <div class="controls">
                <button onclick="testCycleCompletionMessage()">ã‚µã‚¤ã‚¯ãƒ«å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</button>
                <button onclick="testFinalCycleMessage()">æœ€çµ‚ã‚µã‚¤ã‚¯ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</button>
                <button onclick="testAllCompletedMessage()">å…¨å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</button>
            </div>
            <div id="notification-result" class="info" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>âš™ï¸ è¨­å®šãƒ†ã‚¹ãƒˆ</h3>
            <div class="controls">
                <button onclick="testSaveSettings()">è¨­å®šä¿å­˜ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testLoadSettings()">è¨­å®šèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testValidation()">ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ</button>
            </div>
            <div id="settings-result" class="info" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š çµ±è¨ˆæƒ…å ±</h3>
            <div id="cycle-stats" class="status-display">
                çµ±è¨ˆæƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
            </div>
            <div class="controls">
                <button onclick="updateStats()">çµ±è¨ˆæ›´æ–°</button>
            </div>
        </div>
    </div>

    <script type="module">
        // ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        import { 
            calculateCycleState,
            advanceCycle,
            resetCycle,
            getCycleProgressText,
            getCycleCompletionMessage,
            saveCycleSettings,
            loadCycleSettings,
            calculateCycleStats,
            shouldTakeLongBreak,
            DEFAULT_CYCLE_SETTINGS
        } from './src/utils/cycle.js';

        // ãƒ†ã‚¹ãƒˆç”¨ã®çŠ¶æ…‹
        let currentCycleSettings = { ...DEFAULT_CYCLE_SETTINGS };
        let currentCycleState = null;

        // DOMè¦ç´ 
        const totalCyclesSelect = document.getElementById('total-cycles');
        const longBreakIntervalSelect = document.getElementById('long-break-interval');
        const sessionTypeSelect = document.getElementById('session-type');
        const cycleStatusDiv = document.getElementById('cycle-status');
        const cycleProgressBar = document.getElementById('cycle-progress-bar');
        const progressText = document.getElementById('progress-text');
        const cycleStatsDiv = document.getElementById('cycle-stats');

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        totalCyclesSelect.addEventListener('change', updateSettings);
        longBreakIntervalSelect.addEventListener('change', updateSettings);
        sessionTypeSelect.addEventListener('change', updateCycleState);

        // è¨­å®šæ›´æ–°
        function updateSettings() {
            currentCycleSettings.totalCycles = parseInt(totalCyclesSelect.value);
            currentCycleSettings.longBreakInterval = parseInt(longBreakIntervalSelect.value);
            updateCycleState();
        }

        // ã‚µã‚¤ã‚¯ãƒ«çŠ¶æ…‹æ›´æ–°
        window.updateCycleState = function() {
            const sessionType = sessionTypeSelect.value;
            currentCycleState = calculateCycleState(currentCycleSettings, sessionType);
            
            // çŠ¶æ…‹è¡¨ç¤ºã‚’æ›´æ–°
            cycleStatusDiv.innerHTML = `
                <strong>ã‚µã‚¤ã‚¯ãƒ«è¨­å®š:</strong><br>
                ç·ã‚µã‚¤ã‚¯ãƒ«æ•°: ${currentCycleSettings.totalCycles}<br>
                é•·ã„ä¼‘æ†©é–“éš”: ${currentCycleSettings.longBreakInterval}<br>
                ç¾åœ¨ã®ã‚µã‚¤ã‚¯ãƒ«: ${currentCycleSettings.currentCycle}<br>
                å®Œäº†ãƒ•ãƒ©ã‚°: ${currentCycleSettings.isCompleted}<br><br>
                
                <strong>ã‚µã‚¤ã‚¯ãƒ«çŠ¶æ…‹:</strong><br>
                ç¾åœ¨ã®ã‚µã‚¤ã‚¯ãƒ«: ${currentCycleState.currentCycle}/${currentCycleState.totalCycles}<br>
                æœ€çµ‚ã‚µã‚¤ã‚¯ãƒ«: ${currentCycleState.isLastCycle ? 'ã¯ã„' : 'ã„ã„ãˆ'}<br>
                æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³: ${currentCycleState.nextSessionType || 'å®Œäº†'}<br>
                é€²è¡Œç‡: ${currentCycleState.progressPercentage.toFixed(1)}%<br>
                å®Œäº†çŠ¶æ…‹: ${currentCycleState.isCompleted ? 'å®Œäº†' : 'é€²è¡Œä¸­'}<br><br>
                
                <strong>è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ:</strong><br>
                ${getCycleProgressText(currentCycleState)}
            `;
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’æ›´æ–°
            cycleProgressBar.style.width = `${currentCycleState.progressPercentage}%`;
            progressText.textContent = `${currentCycleState.progressPercentage.toFixed(1)}% å®Œäº†`;
            
            // çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
            updateStats();
        };

        // æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ã«é€²ã‚€
        window.advanceToNextCycle = function() {
            const sessionType = sessionTypeSelect.value;
            currentCycleSettings = advanceCycle(currentCycleSettings, sessionType);
            
            // é•·ã„ä¼‘æ†©ã®åˆ¤å®š
            if (shouldTakeLongBreak(currentCycleSettings, sessionType)) {
                alert('ğŸ›Œ é•·ã„ä¼‘æ†©ã®æ™‚é–“ã§ã™ï¼');
            }
            
            updateCycleState();
        };

        // ã‚µã‚¤ã‚¯ãƒ«ãƒªã‚»ãƒƒãƒˆ
        window.resetCycleState = function() {
            currentCycleSettings = resetCycle(currentCycleSettings);
            updateCycleState();
        };

        // ãƒ•ãƒ«ã‚µã‚¤ã‚¯ãƒ«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        window.simulateFullCycle = function() {
            resetCycleState();
            
            const simulate = () => {
                if (!currentCycleState.isCompleted) {
                    setTimeout(() => {
                        advanceToNextCycle();
                        simulate();
                    }, 1000);
                } else {
                    alert('ğŸ‰ ãƒ•ãƒ«ã‚µã‚¤ã‚¯ãƒ«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ï¼');
                }
            };
            
            simulate();
        };

        // é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
        window.testCycleCompletionMessage = function() {
            const message = getCycleCompletionMessage(currentCycleState);
            showNotificationResult(message);
        };

        window.testFinalCycleMessage = function() {
            // æœ€çµ‚ã‚µã‚¤ã‚¯ãƒ«ã®çŠ¶æ…‹ã‚’ä½œæˆ
            const finalState = {
                ...currentCycleState,
                currentCycle: currentCycleSettings.totalCycles,
                isLastCycle: true,
                isCompleted: false
            };
            const message = getCycleCompletionMessage(finalState);
            showNotificationResult(message);
        };

        window.testAllCompletedMessage = function() {
            // å®Œäº†çŠ¶æ…‹ã‚’ä½œæˆ
            const completedState = {
                ...currentCycleState,
                isCompleted: true
            };
            const message = getCycleCompletionMessage(completedState);
            showNotificationResult(message);
        };

        function showNotificationResult(message) {
            const notificationResult = document.getElementById('notification-result');
            notificationResult.style.display = 'block';
            notificationResult.innerHTML = `<strong>é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong><br>${message}`;
        }

        // è¨­å®šãƒ†ã‚¹ãƒˆ
        window.testSaveSettings = async function() {
            const settingsResult = document.getElementById('settings-result');
            
            try {
                await saveCycleSettings(currentCycleSettings);
                settingsResult.style.display = 'block';
                settingsResult.innerHTML = `
                    <strong>è¨­å®šä¿å­˜ãƒ†ã‚¹ãƒˆçµæœ:</strong><br>
                    ä¿å­˜ã•ã‚ŒãŸè¨­å®š: ${JSON.stringify(currentCycleSettings, null, 2)}<br>
                    <span style="color: green;">âœ… è¨­å®šã®ä¿å­˜ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™</span>
                `;
            } catch (error) {
                settingsResult.style.display = 'block';
                settingsResult.innerHTML = `
                    <strong>è¨­å®šä¿å­˜ãƒ†ã‚¹ãƒˆçµæœ:</strong><br>
                    <span style="color: red;">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</span>
                `;
            }
        };

        window.testLoadSettings = async function() {
            const settingsResult = document.getElementById('settings-result');
            
            try {
                const loadedSettings = await loadCycleSettings();
                settingsResult.style.display = 'block';
                settingsResult.innerHTML = `
                    <strong>è¨­å®šèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆçµæœ:</strong><br>
                    èª­ã¿è¾¼ã¾ã‚ŒãŸè¨­å®š: ${JSON.stringify(loadedSettings, null, 2)}<br>
                    <span style="color: green;">âœ… è¨­å®šã®èª­ã¿è¾¼ã¿ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™</span>
                `;
            } catch (error) {
                settingsResult.style.display = 'block';
                settingsResult.innerHTML = `
                    <strong>è¨­å®šèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆçµæœ:</strong><br>
                    <span style="color: red;">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</span>
                `;
            }
        };

        window.testValidation = function() {
            const settingsResult = document.getElementById('settings-result');
            
            // ç„¡åŠ¹ãªå€¤ã§ãƒ†ã‚¹ãƒˆ
            const invalidSettings = {
                totalCycles: 15, // ä¸Šé™è¶…é
                longBreakInterval: 1, // ä¸‹é™æœªæº€
                currentCycle: -1, // è² ã®å€¤
                isCompleted: 'invalid' // å‹é•ã„
            };
            
            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã¯ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ããªã„ãŸã‚ã€è¨­å®šä¿å­˜ã§ãƒ†ã‚¹ãƒˆ
            settingsResult.style.display = 'block';
            settingsResult.innerHTML = `
                <strong>ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ:</strong><br>
                å…¥åŠ›å€¤: ${JSON.stringify(invalidSettings, null, 2)}<br>
                <span style="color: blue;">â„¹ï¸ è¨­å®šä¿å­˜æ™‚ã«è‡ªå‹•çš„ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã¾ã™</span>
            `;
        };

        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        window.updateStats = function() {
            const stats = calculateCycleStats(currentCycleSettings);
            
            cycleStatsDiv.innerHTML = `
                <strong>ã‚µã‚¤ã‚¯ãƒ«çµ±è¨ˆ:</strong><br>
                å®Œäº†ã—ãŸã‚µã‚¤ã‚¯ãƒ«: ${stats.completedCycles}<br>
                æ®‹ã‚Šã®ã‚µã‚¤ã‚¯ãƒ«: ${stats.remainingCycles}<br>
                å®Œäº†ç‡: ${stats.completionRate.toFixed(1)}%
            `;
        };

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ã‚µã‚¤ã‚¯ãƒ«æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            updateCycleState();
        });
    </script>
</body>
</html> 