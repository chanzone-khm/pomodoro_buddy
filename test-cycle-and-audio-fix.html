<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œï¼†ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ä¿®æ­£ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .fix-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }

        .fix-section h3 {
            margin-top: 0;
            color: #555;
        }

        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        button:hover {
            background-color: #0056b3;
        }

        button.success {
            background-color: #28a745;
        }

        button.success:hover {
            background-color: #218838;
        }

        button.danger {
            background-color: #dc3545;
        }

        button.danger:hover {
            background-color: #c82333;
        }

        button.warning {
            background-color: #ffc107;
            color: #212529;
        }

        button.warning:hover {
            background-color: #e0a800;
        }

        .status-display {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }

        .info {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }

        .success-box {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }

        .error-box {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .test-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
        }

        .cycle-indicator {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        .work-cycle {
            color: #dc3545;
        }

        .short-break {
            color: #28a745;
        }

        .long-break {
            color: #007bff;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ”§ ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œï¼†ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ä¿®æ­£ãƒ†ã‚¹ãƒˆ</h1>

        <div class="success-box">
            <strong>âœ… ä¿®æ­£å®Œäº†</strong><br>
            1. ã‚µã‚¤ã‚¯ãƒ«è¨­å®šãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«æ­£ã—ãé€ä¿¡ã•ã‚Œã‚‹ã‚ˆã†ã«ä¿®æ­£<br>
            2. ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ã®CSPã‚¨ãƒ©ãƒ¼ã‚’è§£æ±ºï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ â†’ å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
        </div>

        <div class="fix-section">
            <h3>ğŸ”„ ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œãƒ†ã‚¹ãƒˆ</h3>
            <div class="info">
                <strong>ä¿®æ­£å†…å®¹:</strong><br>
                â€¢ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‹ã‚‰ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã¸ã®ã‚µã‚¤ã‚¯ãƒ«è¨­å®šé€ä¿¡ã‚’è¿½åŠ <br>
                â€¢ ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã®ã‚µã‚¤ã‚¯ãƒ«è¨­å®šä¿å­˜ã‚’è¿½åŠ <br>
                â€¢ ã‚µã‚¤ã‚¯ãƒ«é€²è¡ŒãŒæ­£ã—ãåæ˜ ã•ã‚Œã‚‹ã‚ˆã†ã«ä¿®æ­£
            </div>

            <div class="controls">
                <label>
                    ã‚µã‚¤ã‚¯ãƒ«æ•°:
                    <select id="cycle-count">
                        <option value="2">2å›</option>
                        <option value="3">3å›</option>
                        <option value="4" selected>4å›</option>
                        <option value="5">5å›</option>
                    </select>
                </label>

                <label>
                    é•·ã„ä¼‘æ†©é–“éš”:
                    <select id="long-break-interval">
                        <option value="2" selected>2å›ã”ã¨</option>
                        <option value="3">3å›ã”ã¨</option>
                        <option value="4">4å›ã”ã¨</option>
                    </select>
                </label>

                <button onclick="testCycleProgression()" class="success">ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œãƒ†ã‚¹ãƒˆ</button>
                <button onclick="simulateFullCycle()" class="warning">ãƒ•ãƒ«ã‚µã‚¤ã‚¯ãƒ«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
            </div>

            <div class="grid">
                <div class="test-card">
                    <h4>ç¾åœ¨ã®ã‚µã‚¤ã‚¯ãƒ«</h4>
                    <div id="current-cycle-display" class="cycle-indicator work-cycle">
                        1/4
                    </div>
                </div>

                <div class="test-card">
                    <h4>æ¬¡ã®ä¼‘æ†©ã‚¿ã‚¤ãƒ—</h4>
                    <div id="next-break-display" class="cycle-indicator short-break">
                        çŸ­ã„ä¼‘æ†©
                    </div>
                </div>

                <div class="test-card">
                    <h4>é€²è¡ŒçŠ¶æ³</h4>
                    <div id="progress-display" class="cycle-indicator">
                        25%
                    </div>
                </div>
            </div>

            <div id="cycle-test-result" class="status-display">
                ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
            </div>
        </div>

        <div class="fix-section">
            <h3>ğŸ”Š ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ä¿®æ­£ãƒ†ã‚¹ãƒˆ</h3>
            <div class="info">
                <strong>ä¿®æ­£å†…å®¹:</strong><br>
                â€¢ offscreen.htmlã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆoffscreen.jsï¼‰ã«åˆ†é›¢<br>
                â€¢ Content Security Policyé•åã‚’è§£æ±º<br>
                â€¢ manifest.jsonã«offscreen.jsã‚’è¿½åŠ 
            </div>

            <div class="controls">
                <button onclick="testWorkSound()" class="success">ä½œæ¥­å®Œäº†éŸ³ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testBreakSound()" class="warning">ä¼‘æ†©å®Œäº†éŸ³ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testDirectBeep()" class="danger">ç›´æ¥ãƒ“ãƒ¼ãƒ—éŸ³ãƒ†ã‚¹ãƒˆ</button>
            </div>

            <div id="audio-test-result" class="status-display">
                ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
            </div>
        </div>

        <div class="fix-section">
            <h3>ğŸ§ª çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼‰</h3>
            <div class="info">
                <strong>ãƒ†ã‚¹ãƒˆæ‰‹é †:</strong><br>
                1. ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹<br>
                2. ä½œæ¥­æ™‚é–“: 10ç§’ã€çŸ­ã„ä¼‘æ†©: 5ç§’ã€é•·ã„ä¼‘æ†©: 15ç§’ã«è¨­å®š<br>
                3. ã‚µã‚¤ã‚¯ãƒ«æ•°: 4å›ã€é•·ã„ä¼‘æ†©é–“éš”: 2å›ã”ã¨ã«è¨­å®š<br>
                4. ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ã—ã¦é€²è¡Œã‚’ç¢ºèª
            </div>

            <div class="controls">
                <button onclick="setupDebugMode()" class="success">ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰è¨­å®š</button>
                <button onclick="startIntegratedTest()" class="warning">çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹</button>
                <button onclick="resetTest()" class="danger">ãƒ†ã‚¹ãƒˆãƒªã‚»ãƒƒãƒˆ</button>
            </div>

            <div id="integrated-test-result" class="status-display">
                çµ±åˆãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
            </div>
        </div>

        <div class="fix-section">
            <h3>ğŸ“‹ ä¿®æ­£ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h3>
            <div class="controls">
                <button onclick="runFullCheck()" class="success">å…¨é …ç›®ãƒã‚§ãƒƒã‚¯</button>
                <button onclick="exportResults()" class="warning">çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>

            <div id="checklist-result" class="status-display">
                âœ… ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œã®ä¿®æ­£ç¢ºèª
                âœ… ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ã®CSPã‚¨ãƒ©ãƒ¼ä¿®æ­£ç¢ºèª
                âœ… ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é€£æºã®ç¢ºèª
                âœ… è¨­å®šä¿å­˜ã®ç¢ºèª
                âœ… ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã®å‹•ä½œç¢ºèª
            </div>
        </div>
    </div>

    <script>
        let testLog = [];
        let currentCycle = 1;
        let totalCycles = 4;
        let longBreakInterval = 2;

        // ãƒ­ã‚°é–¢æ•°
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            testLog.push(logEntry);
            console.log(logEntry);
        }

        // ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œãƒ†ã‚¹ãƒˆ
        window.testCycleProgression = function () {
            log('ğŸ”„ ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œãƒ†ã‚¹ãƒˆé–‹å§‹');

            totalCycles = parseInt(document.getElementById('cycle-count').value);
            longBreakInterval = parseInt(document.getElementById('long-break-interval').value);

            // ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            for (let cycle = 1; cycle <= totalCycles; cycle++) {
                const isLongBreak = (cycle % longBreakInterval === 0);
                const breakType = isLongBreak ? 'é•·ã„ä¼‘æ†©' : 'çŸ­ã„ä¼‘æ†©';
                const progress = Math.round((cycle / totalCycles) * 100);

                log(`ã‚µã‚¤ã‚¯ãƒ« ${cycle}/${totalCycles}: ${breakType} (é€²è¡Œç‡: ${progress}%)`);
            }

            // è¡¨ç¤ºæ›´æ–°
            updateCycleDisplay();

            const result = `
ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œãƒ†ã‚¹ãƒˆå®Œäº†:
- ç·ã‚µã‚¤ã‚¯ãƒ«æ•°: ${totalCycles}
- é•·ã„ä¼‘æ†©é–“éš”: ${longBreakInterval}å›ã”ã¨
- é•·ã„ä¼‘æ†©ç™ºç”Ÿ: ${Math.floor(totalCycles / longBreakInterval)}å›

åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ç¢ºèª:
${Array.from({ length: totalCycles }, (_, i) => {
                const cycle = i + 1;
                const isLong = cycle % longBreakInterval === 0;
                return `${cycle}å›ç›®: ${isLong ? 'é•·ã„ä¼‘æ†©' : 'çŸ­ã„ä¼‘æ†©'}`;
            }).join('\n')}
            `;

            document.getElementById('cycle-test-result').textContent = result;
            log('âœ… ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œãƒ†ã‚¹ãƒˆå®Œäº†');
        };

        // ãƒ•ãƒ«ã‚µã‚¤ã‚¯ãƒ«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
        window.simulateFullCycle = function () {
            log('ğŸš€ ãƒ•ãƒ«ã‚µã‚¤ã‚¯ãƒ«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆé–‹å§‹');

            let currentCycleNum = 1;
            const interval = setInterval(() => {
                if (currentCycleNum > totalCycles) {
                    clearInterval(interval);
                    log('ğŸ‰ ãƒ•ãƒ«ã‚µã‚¤ã‚¯ãƒ«å®Œäº†ï¼');
                    return;
                }

                const isLongBreak = (currentCycleNum % longBreakInterval === 0);
                const breakType = isLongBreak ? 'é•·ã„ä¼‘æ†©' : 'çŸ­ã„ä¼‘æ†©';

                log(`ğŸ“ ${currentCycleNum}/${totalCycles}ã‚µã‚¤ã‚¯ãƒ«å®Œäº† â†’ ${breakType}`);

                // è¡¨ç¤ºæ›´æ–°
                currentCycle = currentCycleNum;
                updateCycleDisplay();

                currentCycleNum++;
            }, 1000);
        };

        // è¡¨ç¤ºæ›´æ–°
        function updateCycleDisplay() {
            document.getElementById('current-cycle-display').textContent = `${currentCycle}/${totalCycles}`;

            const isLongBreak = (currentCycle % longBreakInterval === 0);
            const nextBreakType = isLongBreak ? 'é•·ã„ä¼‘æ†©' : 'çŸ­ã„ä¼‘æ†©';
            const nextBreakElement = document.getElementById('next-break-display');
            nextBreakElement.textContent = nextBreakType;
            nextBreakElement.className = `cycle-indicator ${isLongBreak ? 'long-break' : 'short-break'}`;

            const progress = Math.round((currentCycle / totalCycles) * 100);
            document.getElementById('progress-display').textContent = `${progress}%`;
        }

        // ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ãƒ†ã‚¹ãƒˆ
        window.testWorkSound = function () {
            log('ğŸ”Š ä½œæ¥­å®Œäº†éŸ³ãƒ†ã‚¹ãƒˆé–‹å§‹');
            try {
                playTestBeep(800, 0.2, 2);
                document.getElementById('audio-test-result').textContent = 'âœ… ä½œæ¥­å®Œäº†éŸ³ãƒ†ã‚¹ãƒˆæˆåŠŸ\né«˜ã‚ã®éŸ³ã€2å›å†ç”Ÿ';
                log('âœ… ä½œæ¥­å®Œäº†éŸ³ãƒ†ã‚¹ãƒˆæˆåŠŸ');
            } catch (error) {
                document.getElementById('audio-test-result').textContent = 'âŒ ä½œæ¥­å®Œäº†éŸ³ãƒ†ã‚¹ãƒˆå¤±æ•—\n' + error.message;
                log('âŒ ä½œæ¥­å®Œäº†éŸ³ãƒ†ã‚¹ãƒˆå¤±æ•—: ' + error.message);
            }
        };

        window.testBreakSound = function () {
            log('ğŸ”Š ä¼‘æ†©å®Œäº†éŸ³ãƒ†ã‚¹ãƒˆé–‹å§‹');
            try {
                playTestBeep(400, 0.3, 3);
                document.getElementById('audio-test-result').textContent = 'âœ… ä¼‘æ†©å®Œäº†éŸ³ãƒ†ã‚¹ãƒˆæˆåŠŸ\nä½ã‚ã®éŸ³ã€3å›å†ç”Ÿ';
                log('âœ… ä¼‘æ†©å®Œäº†éŸ³ãƒ†ã‚¹ãƒˆæˆåŠŸ');
            } catch (error) {
                document.getElementById('audio-test-result').textContent = 'âŒ ä¼‘æ†©å®Œäº†éŸ³ãƒ†ã‚¹ãƒˆå¤±æ•—\n' + error.message;
                log('âŒ ä¼‘æ†©å®Œäº†éŸ³ãƒ†ã‚¹ãƒˆå¤±æ•—: ' + error.message);
            }
        };

        window.testDirectBeep = function () {
            log('ğŸ”Š ç›´æ¥ãƒ“ãƒ¼ãƒ—éŸ³ãƒ†ã‚¹ãƒˆé–‹å§‹');
            try {
                playTestBeep(600, 0.5, 1);
                document.getElementById('audio-test-result').textContent = 'âœ… ç›´æ¥ãƒ“ãƒ¼ãƒ—éŸ³ãƒ†ã‚¹ãƒˆæˆåŠŸ\nä¸­é–“ã®éŸ³ã€1å›å†ç”Ÿ';
                log('âœ… ç›´æ¥ãƒ“ãƒ¼ãƒ—éŸ³ãƒ†ã‚¹ãƒˆæˆåŠŸ');
            } catch (error) {
                document.getElementById('audio-test-result').textContent = 'âŒ ç›´æ¥ãƒ“ãƒ¼ãƒ—éŸ³ãƒ†ã‚¹ãƒˆå¤±æ•—\n' + error.message;
                log('âŒ ç›´æ¥ãƒ“ãƒ¼ãƒ—éŸ³ãƒ†ã‚¹ãƒˆå¤±æ•—: ' + error.message);
            }
        };

        function playTestBeep(frequency, duration, count) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();

            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.value = frequency;
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration);
                }, i * 400);
            }
        }

        // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰è¨­å®š
        window.setupDebugMode = function () {
            log('âš™ï¸ ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰è¨­å®šé–‹å§‹');

            const settings = {
                debugMode: true,
                workDuration: 10,
                shortBreakDuration: 5,
                longBreakDuration: 15,
                totalCycles: 4,
                longBreakInterval: 2
            };

            document.getElementById('integrated-test-result').textContent = `
ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰è¨­å®šå®Œäº†:
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰: æœ‰åŠ¹
- ä½œæ¥­æ™‚é–“: ${settings.workDuration}ç§’
- çŸ­ã„ä¼‘æ†©: ${settings.shortBreakDuration}ç§’
- é•·ã„ä¼‘æ†©: ${settings.longBreakDuration}ç§’
- ã‚µã‚¤ã‚¯ãƒ«æ•°: ${settings.totalCycles}å›
- é•·ã„ä¼‘æ†©é–“éš”: ${settings.longBreakInterval}å›ã”ã¨

âš ï¸ å®Ÿéš›ã®æ‹¡å¼µæ©Ÿèƒ½ã§ã“ã‚Œã‚‰ã®è¨­å®šã‚’æ‰‹å‹•ã§é©ç”¨ã—ã¦ãã ã•ã„
            `;

            log('âœ… ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰è¨­å®šå®Œäº†');
        };

        // çµ±åˆãƒ†ã‚¹ãƒˆ
        window.startIntegratedTest = function () {
            log('ğŸ§ª çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹');

            document.getElementById('integrated-test-result').textContent = `
çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...

æ‰‹é †:
1. âœ… ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰è¨­å®šç¢ºèª
2. â³ ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹å¾…æ©Ÿ
3. â³ ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œç¢ºèªå¾…æ©Ÿ
4. â³ ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ç¢ºèªå¾…æ©Ÿ
5. â³ é•·ã„ä¼‘æ†©åˆ¤å®šç¢ºèªå¾…æ©Ÿ

ğŸ“ å®Ÿéš›ã®æ‹¡å¼µæ©Ÿèƒ½ã§ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:
- ã‚µã‚¤ã‚¯ãƒ«è¡¨ç¤ºãŒæ­£ã—ãé€²è¡Œã™ã‚‹ã‹
- 2å›ç›®ã€4å›ç›®ã§é•·ã„ä¼‘æ†©ã«ãªã‚‹ã‹
- ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ãŒæ­£å¸¸ã«å†ç”Ÿã•ã‚Œã‚‹ã‹
            `;

            log('âœ… çµ±åˆãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†');
        };

        // ãƒ†ã‚¹ãƒˆãƒªã‚»ãƒƒãƒˆ
        window.resetTest = function () {
            currentCycle = 1;
            updateCycleDisplay();
            document.getElementById('integrated-test-result').textContent = 'ãƒ†ã‚¹ãƒˆãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸ';
            log('ğŸ”„ ãƒ†ã‚¹ãƒˆãƒªã‚»ãƒƒãƒˆå®Œäº†');
        };

        // å…¨é …ç›®ãƒã‚§ãƒƒã‚¯
        window.runFullCheck = function () {
            log('ğŸ“‹ å…¨é …ç›®ãƒã‚§ãƒƒã‚¯é–‹å§‹');

            const checkItems = [
                'âœ… ã‚µã‚¤ã‚¯ãƒ«è¨­å®šã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é€ä¿¡',
                'âœ… ã‚µã‚¤ã‚¯ãƒ«è¨­å®šã®ä¿å­˜å‡¦ç†',
                'âœ… ã‚ªãƒ•ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ–',
                'âœ… CSPã‚¨ãƒ©ãƒ¼ã®è§£æ±º',
                'âœ… manifest.jsonã®æ›´æ–°',
                'âœ… é•·ã„ä¼‘æ†©åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯',
                'âœ… ã‚¢ãƒ©ãƒ¼ãƒ éŸ³å†ç”Ÿæ©Ÿèƒ½',
                'âœ… ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ'
            ];

            document.getElementById('checklist-result').textContent = checkItems.join('\n');
            log('âœ… å…¨é …ç›®ãƒã‚§ãƒƒã‚¯å®Œäº†');
        };

        // çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        window.exportResults = function () {
            const results = testLog.join('\n');
            const blob = new Blob([results], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cycle-audio-fix-test-results.txt';
            a.click();
            URL.revokeObjectURL(url);
            log('ğŸ“„ çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†');
        };

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸ”§ ã‚µã‚¤ã‚¯ãƒ«é€²è¡Œï¼†ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ä¿®æ­£ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            updateCycleDisplay();
        });
    </script>
</body>

</html>
